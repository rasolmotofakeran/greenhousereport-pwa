
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ú¯Ù„Ø®Ø§Ù†Ù‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon.png" />
  <meta name="theme-color" content="#4CAF50" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-date/dist/persian-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css" />
  <style>
    body {
      font-family: Tahoma, sans-serif;
      padding: 16px;
      background-color: #f0f4f8;
      color: #333;
      max-width: 100%;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 20px;
    }
    label {
      display: block;
      margin-top: 14px;
      font-weight: bold;
      font-size: 15px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      margin-top: 14px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .report-box {
      background: #fff;
      padding: 10px;
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    button:hover { opacity: 0.95; }
    .btn-green { background: #4CAF50; color: #fff; }
    .btn-red { background: #f44336; color: #fff; }
    .btn-blue { background: #2196F3; color: #fff; }
    @media (max-width: 600px) {
      h1 { font-size: 18px; }
      label { font-size: 14px; }
      input, select, textarea { font-size: 13px; }
      button { font-size: 15px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ú¯Ù„Ø®Ø§Ù†Ù‡</h1>
  <label>ØªØ§Ø±ÛŒØ®</label>
  <input type="text" id="report-date" readonly style="background:#fff; cursor:pointer;" />
  <label>Ù†Ø§Ù… Ø³Ø§Ù„Ù†</label>
  <select id="greenhouse-name">
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ù„Ù†</option>
<option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 7">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 7</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 8">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 8</option>
  </select>
  <label>Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØª</label>
  <select id="task-type">
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ¹Ø§Ù„ÛŒØª</option>
    <option value="irrigation">Ø¢Ø¨ÛŒØ§Ø±ÛŒ</option>
    <option value="spraying">Ù…Ø­Ù„ÙˆÙ„â€ŒÙ¾Ø§Ø´ÛŒ</option>
    <option value="pesticide">Ø³Ù…â€ŒÙ¾Ø§Ø´ÛŒ</option>
    <option value="harvest">Ø¨Ø±Ø¯Ø§Ø´Øª</option>
    <option value="repair">ØªØ¹Ù…ÛŒØ±Ø§Øª</option>
    <option value="maintenance">Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</option>
    <option value="other">Ø³Ø§ÛŒØ±</option>
  </select>
  <label>ØªÙˆØ¶ÛŒØ­ ÙØ¹Ø§Ù„ÛŒØª</label>
  <textarea id="task-desc" rows="2"></textarea>
  <label>Ø²Ù…Ø§Ù†</label>
  <input type="text" id="task-time" />
  <label>Ù†Ø§Ù… Ù…Ø³Ø¦ÙˆÙ„</label>
  <input type="text" id="task-person" />
  <label>Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡</label>
  <textarea id="plant-status" rows="2"></textarea>

  <button class="btn-green" onclick="saveReport()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
  <button class="btn-blue" onclick="renderReports()">ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</button>
  <button class="btn-red" onclick="clearReports()">ğŸ—‘ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ</button>
  <input type="file" id="fileLoader" accept="application/json" />
  <button class="btn-gray" onclick="loadFromFile()">ğŸ“‚ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„</button>
  <button class="btn-yellow" onclick="downloadReports()">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ JSON</button>
  <button class="btn-blue" onclick="shareData()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„</button>

  <div id="report-list"></div>

  <script>
    $('#report-date').persianDatepicker({
      initialValueType: 'persian',
      format: 'YYYY/MM/DD',
      autoClose: true
    });

    function getKey(hall, type) {
      return "greenhouseReports_" + hall + "_" + type;
    }

    function saveReport() {
      const hall = document.getElementById("greenhouse-name").value;
      const typeSel = document.getElementById("task-type");
      const type = typeSel.value;
      const typeText = typeSel.options[typeSel.selectedIndex].text;
      const report = {
        date: document.getElementById("report-date").value,
        hall,
        type: typeText,
        desc: document.getElementById("task-desc").value,
        time: document.getElementById("task-time").value,
        person: document.getElementById("task-person").value,
        plant: document.getElementById("plant-status").value
      };
      if (!report.date || !hall || !type || !report.desc || !report.person) {
        alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.");
        return;
      }
      const key = getKey(hall, type);
      const data = JSON.parse(localStorage.getItem(key) || "[]");
      data.push(report);
      localStorage.setItem(key, JSON.stringify(data));
      renderReports();
      alert("âœ… Ø«Ø¨Øª Ø´Ø¯");
    }

    function renderReports() {
      const hall = document.getElementById("greenhouse-name").value;
      const container = document.getElementById("report-list");
      if (!hall) {
        container.innerHTML = "<p>Ù†Ø§Ù… Ø³Ø§Ù„Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>";
        return;
      }
      const keys = ["irrigation", "spraying", "pesticide", "harvest", "repair", "maintenance", "other"];
      let all = [];
      keys.forEach(k => {
        const key = getKey(hall, k);
        const d = JSON.parse(localStorage.getItem(key) || "[]");
        all = all.concat(d);
      });
      if (!all.length) {
        container.innerHTML = "<p>Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>";
        return;
      }
      container.innerHTML = all.map(r => `
        <div class="report-box">
          <strong>ØªØ§Ø±ÛŒØ®:</strong> ${r.date}<br>
          <strong>Ø³Ø§Ù„Ù†:</strong> ${r.hall}<br>
          <strong>ÙØ¹Ø§Ù„ÛŒØª:</strong> ${r.type}<br>
          <strong>ØªÙˆØ¶ÛŒØ­:</strong> ${r.desc}<br>
          <strong>Ø²Ù…Ø§Ù†:</strong> ${r.time}<br>
          <strong>Ù…Ø³Ø¦ÙˆÙ„:</strong> ${r.person}<br>
          <strong>Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡:</strong> ${r.plant}
        </div>`).join('');
    }

    function clearReports() {
      const hall = document.getElementById("greenhouse-name").value;
      const types = ["irrigation", "spraying", "pesticide", "harvest", "repair", "maintenance", "other"];
      types.forEach(t => localStorage.removeItem(getKey(hall, t)));
      renderReports();
    }

    function downloadReports() {
      const hall = document.getElementById("greenhouse-name").value;
      const types = ["irrigation", "spraying", "pesticide", "harvest", "repair", "maintenance", "other"];
      let all = [];
      types.forEach(t => {
        const d = JSON.parse(localStorage.getItem(getKey(hall, t)) || "[]");
        all = all.concat(d);
      });
      const blob = new Blob([JSON.stringify(all)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = hall + "_reports.json";
      a.click();
    }

    function loadFromFile() {
      const input = document.getElementById("fileLoader");
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const imported = JSON.parse(e.target.result);
          if (!Array.isArray(imported)) throw "ÙØ±Ù…Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª";
          const hall = document.getElementById("greenhouse-name").value;
          const type = document.getElementById("task-type").value;
          localStorage.setItem(getKey(hall, type), JSON.stringify(imported));
          renderReports();
          alert("âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆÙÙ‚");
        } catch (err) {
          alert("âŒ Ø®Ø·Ø§: " + err);
        }
      };
      reader.readAsText(file);
    }

    function shareData() {
      const hall = document.getElementById("greenhouse-name").value;
      const types = ["irrigation", "spraying", "pesticide", "harvest", "repair", "maintenance", "other"];
      let all = [];
      types.forEach(t => {
        const d = JSON.parse(localStorage.getItem(getKey(hall, t)) || "[]");
        all = all.concat(d);
      });
      if (!all.length) return alert("Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
      const last = all[all.length - 1];
      const msg = `ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´
ØªØ§Ø±ÛŒØ®: ${last.date}
Ø³Ø§Ù„Ù†: ${last.hall}
ÙØ¹Ø§Ù„ÛŒØª: ${last.type}
ØªÙˆØ¶ÛŒØ­: ${last.desc}
Ø²Ù…Ø§Ù†: ${last.time}
Ù…Ø³Ø¦ÙˆÙ„: ${last.person}
Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡: ${last.plant}`;
      if (navigator.share) {
        navigator.share({ text: msg });
      } else {
        prompt("Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ:", msg);
      }
    }

    // Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙˆØ±Ú©Ø±
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log("SW Ø«Ø¨Øª Ø´Ø¯", reg))
        .catch(err => console.log("SW Ø«Ø¨Øª Ù†Ø´Ø¯", err));
    }
  </script>
</body>
</html>
